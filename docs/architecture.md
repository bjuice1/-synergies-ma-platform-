# M&A Synergies Analysis Tool - System Architecture

**Last Updated:** 2026-02-15
**Generated By:** Claude Code Documentation System

---

## System Overview

The M&A Synergies Analysis Tool is a Flask-based web application for analyzing and tracking merger & acquisition synergies, companies, and financial data.

**Stack:**
- **Backend:** Python 3.x with Flask
- **Database:** PostgreSQL
- **Frontend:** Vanilla JavaScript
- **Authentication:** JWT (JSON Web Tokens)
- **ORM:** SQLAlchemy
- **Migrations:** Alembic
- **API:** RESTful API with versioning (v1, v2)

---

## High-Level Architecture

```
┌──────────────────────────────────────────────────────────────┐
│                        FRONTEND LAYER                         │
│  ┌────────────────────────────────────────────────────────┐  │
│  │  Web Interface (Vanilla JS + HTML/CSS)                 │  │
│  │  - Dashboard                                           │  │
│  │  - Analytics Views                                     │  │
│  │  - Synergy Management                                  │  │
│  └────────────────────────────────────────────────────────┘  │
└─────────────────────────┬────────────────────────────────────┘
                          │ HTTPS/JSON
                          │
┌─────────────────────────▼────────────────────────────────────┐
│                      API GATEWAY LAYER                        │
│  ┌────────────────────────────────────────────────────────┐  │
│  │  Flask Application (app.py)                            │  │
│  │  - CORS Configuration                                  │  │
│  │  - Request Routing                                     │  │
│  │  - Health Check (/health)                              │  │
│  └────────────────────────────────────────────────────────┘  │
└─────────────────────────┬────────────────────────────────────┘
                          │
┌─────────────────────────▼────────────────────────────────────┐
│                    MIDDLEWARE LAYER                           │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────────┐   │
│  │ Auth         │  │ Rate         │  │ API Versioning   │   │
│  │ Middleware   │  │ Limiting     │  │ (v1/v2)          │   │
│  └──────────────┘  └──────────────┘  └──────────────────┘   │
└─────────────────────────┬────────────────────────────────────┘
                          │
┌─────────────────────────▼────────────────────────────────────┐
│                       API BLUEPRINTS                          │
│  ┌──────────┬──────────┬──────────┬──────────┬─────────────┐ │
│  │ Auth     │Synergies │Analytics │ Deals    │Notifications│ │
│  │ API      │ API      │ API      │ API      │ API         │ │
│  └──────────┴──────────┴──────────┴──────────┴─────────────┘ │
│  ┌──────────┬──────────┬──────────┬──────────┬─────────────┐ │
│  │Users API │Templates │Workflows │Activity  │Visualizations│ │
│  │          │ API      │ API      │Logs API  │ API         │ │
│  └──────────┴──────────┴──────────┴──────────┴─────────────┘ │
└─────────────────────────┬────────────────────────────────────┘
                          │
┌─────────────────────────▼────────────────────────────────────┐
│                       SERVICE LAYER                           │
│  ┌──────────────────────────────────────────────────────────┐│
│  │ Business Logic Services                                  ││
│  │ - SynergyService      - AnalyticsService                 ││
│  │ - UserService         - ExportService                    ││
│  │ - CompanyService      - WorkflowEngine                   ││
│  │ - FinancialService    - EmailService                     ││
│  │ - TemplateService     - ActivityLogger                   ││
│  │ - AuditService        - WidgetFactory                    ││
│  └──────────────────────────────────────────────────────────┘│
└─────────────────────────┬────────────────────────────────────┘
                          │
┌─────────────────────────▼────────────────────────────────────┐
│                    REPOSITORY LAYER (Data Access)             │
│  ┌──────────────────────────────────────────────────────────┐│
│  │ Repository Pattern                                        ││
│  │ - UserRepository       - SynergyRepository               ││
│  │ - AnalyticsRepository  - TemplateRepository              ││
│  │ - NotificationRepository - ActivityLogRepository         ││
│  │ - CommentRepository    - VisualizationRepository         ││
│  └──────────────────────────────────────────────────────────┘│
└─────────────────────────┬────────────────────────────────────┘
                          │
┌─────────────────────────▼────────────────────────────────────┐
│                         DATA LAYER                            │
│  ┌────────────────────────────────────────────────────────┐  │
│  │  SQLAlchemy ORM + PostgreSQL Database                  │  │
│  │                                                         │  │
│  │  Core Models:                                          │  │
│  │  - User            - Company         - Analysis        │  │
│  │  - Synergy         - Deal            - Financial Data  │  │
│  │  - Template        - Notification    - Audit Log       │  │
│  │  - Activity Log    - Workflow        - Visualization   │  │
│  └────────────────────────────────────────────────────────┘  │
└───────────────────────────────────────────────────────────────┘

┌───────────────────────────────────────────────────────────────┐
│                      EXTERNAL INTEGRATIONS                     │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────────┐    │
│  │ Email Service│  │ PDF Export   │  │ Excel Export     │    │
│  │ (SMTP)       │  │ Service      │  │ Service          │    │
│  └──────────────┘  └──────────────┘  └──────────────────┘    │
└───────────────────────────────────────────────────────────────┘

┌───────────────────────────────────────────────────────────────┐
│                      SUPPORTING SYSTEMS                        │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────────┐    │
│  │ Redis Cache  │  │ Full-Text    │  │ Alembic          │    │
│  │ (Optional)   │  │ Search       │  │ Migrations       │    │
│  └──────────────┘  └──────────────┘  └──────────────────┘    │
└───────────────────────────────────────────────────────────────┘
```

---

## Key Components

### 1. **Frontend Layer**
- **Location:** `/frontend`
- **Technology:** Vanilla JavaScript, HTML, CSS
- **Entry Point:** `frontend/app.js`
- **Key Features:**
  - Dashboard with synergy visualization
  - Analytics charts and reporting
  - User management interface
  - Responsive design

### 2. **API Gateway**
- **Location:** `/backend/app.py`
- **Responsibilities:**
  - Route incoming requests to appropriate blueprints
  - CORS configuration for cross-origin requests
  - Health check endpoint (`/health`)
  - Blueprint registration

### 3. **Middleware**
- **Auth Middleware:** JWT token validation (`backend/app/middleware/auth_middleware.py`)
- **Rate Limiter:** Request throttling (`backend/app/extensions/limiter.py`)
- **API Versioning:** Version routing (`backend/app/middleware/versioning.py`)

### 4. **API Blueprints**
Organized by feature domain:
- **Auth:** `/backend/api/auth.py`, `/backend/app/auth/routes.py`
- **Synergies:** `/backend/api/synergies.py`
- **Analytics:** `/backend/api/analytics.py`
- **Deals:** `/backend/api/deals.py`
- **Notifications:** `/backend/app/api/notifications.py`
- **Templates:** `/backend/app/routes/templates.py`
- **Activity Logs:** `/backend/app/routes/activity_logs.py`

### 5. **Service Layer**
Business logic encapsulation:
- **SynergyService:** Synergy calculation and management
- **AnalyticsService:** Data aggregation and metrics
- **UserService:** User management and authentication
- **ExportService:** PDF/Excel export generation
- **WorkflowEngine:** Automated workflow processing
- **EmailService:** Email notifications
- **AuditService:** Audit trail tracking

### 6. **Repository Layer**
Data access abstraction:
- **Pattern:** Repository pattern for database operations
- **Unit of Work:** Transaction management (`backend/app/db/unit_of_work.py`)
- **Benefits:** Decouples business logic from data access

### 7. **Data Models**
Core entities (SQLAlchemy ORM):
- **User:** Authentication and authorization
- **Company:** Company information and metadata
- **Synergy:** M&A synergy tracking
- **Deal:** Deal management
- **Analysis:** AI-generated company analyses
- **FinancialData:** Financial metrics
- **Template:** Reusable templates
- **Notification:** User notifications
- **AuditLog:** Audit trail
- **ActivityLog:** User activity tracking

---

## Database Schema

**Database:** PostgreSQL
**Migrations:** Alembic (located in `/backend/migrations`)

**Key Tables:**
- `users` - User accounts
- `companies` - Company profiles
- `analyses` - Company analysis results
- `financial_data` - Financial metrics
- `synergies` - Synergy tracking
- `deals` - Deal management
- `templates` - Reusable templates
- `notifications` - User notifications
- `audit_logs` - Audit trail
- `activity_logs` - Activity tracking

**Features:**
- Full-text search (PostgreSQL search vectors)
- Indexes on frequently queried columns
- Foreign key relationships
- Audit timestamps (created_at, updated_at)

---

## Authentication & Authorization

**Method:** JWT (JSON Web Tokens)

**Flow:**
1. User submits credentials → `/auth/login`
2. Backend validates credentials
3. JWT token generated (24hr expiration)
4. Token sent in `Authorization: Bearer <token>` header
5. Auth middleware validates token on protected routes

**Configuration:**
- Secret Key: Environment variable `JWT_SECRET_KEY`
- Token Location: HTTP Headers
- Expiration: 24 hours (configurable)

**Authorization:**
- Role-based access control (is_superuser flag)
- User ownership validation (users can only access their data)

---

## API Versioning

**Strategy:** URL-based versioning

**Versions:**
- **v1:** `/api/v1/*` - Original API
- **v2:** `/api/v2/*` - Enhanced API with additional features

**Version-specific routes:**
- `/backend/app/api/v1/` - Version 1 endpoints
- `/backend/app/api/v2/` - Version 2 endpoints

**Middleware:** `backend/app/middleware/versioning.py` handles routing

---

## External Integrations

### Email Service
- **Location:** `backend/app/services/email.py`
- **Purpose:** Send notifications, alerts, reports
- **Configuration:** SMTP settings in environment variables

### PDF Export
- **Location:** `backend/services/pdf_service.py`
- **Purpose:** Generate PDF reports
- **Use Cases:** Synergy reports, company analyses

### Excel Export
- **Location:** `backend/app/services/export_service.py`
- **Purpose:** Export data to Excel format
- **Use Cases:** Data downloads, bulk exports

---

## Caching & Performance

### Redis Cache (Optional)
- **Location:** `backend/app/extensions/cache.py`
- **Use Cases:**
  - API response caching
  - Session storage
  - Rate limiting counters

### Full-Text Search
- **Technology:** PostgreSQL text search vectors
- **Location:** `backend/migrations/versions/004_add_search_vector.py`
- **Indexed Fields:** Company names, descriptions, synergy details

---

## File Organization

```
/backend/
├── app/                    # Main application package
│   ├── api/               # API endpoints (v1, v2)
│   ├── auth/              # Authentication
│   ├── models/            # Data models
│   ├── services/          # Business logic
│   ├── repositories/      # Data access
│   ├── schemas/           # Validation schemas
│   ├── middleware/        # Request processing
│   ├── extensions/        # Flask extensions (cache, limiter)
│   └── db/                # Database utilities
├── migrations/            # Alembic migrations
├── app.py                 # Application entry point
├── config.py              # Configuration
└── requirements.txt       # Python dependencies

/frontend/
├── src/
│   └── utils/            # Utility functions
├── app.js                # Main application
└── tests/                # Frontend tests
```

---

## Deployment Configuration

**Environments:**
- Development: `DevelopmentConfig` (DEBUG=True)
- Production: `ProductionConfig` (DEBUG=False, strict secrets)
- Test: `TestConfig` (separate test database)

**Entry Points:**
- **Development:** `python backend/app.py` (port 5000)
- **Production:** Gunicorn server (`backend/gunicorn.conf.py`)

**Health Check:**
- Endpoint: `GET /health`
- Response: `{"status": "healthy"}`

---

## Security Considerations

1. **Secrets Management:**
   - JWT keys in environment variables
   - Database credentials in environment variables
   - No hardcoded secrets

2. **CORS:**
   - Configured in `app.py`
   - Allows specified headers: Content-Type, Authorization

3. **Rate Limiting:**
   - Implemented via `backend/app/extensions/limiter.py`
   - Prevents abuse and DDoS

4. **Input Validation:**
   - Schema validation via `/backend/app/schemas/`
   - Prevents SQL injection, XSS

5. **Audit Trail:**
   - All critical actions logged to `audit_logs` table
   - Tracks user actions, changes, deletions

---

## Key Design Patterns

1. **Repository Pattern:** Decouples data access from business logic
2. **Service Layer:** Encapsulates business logic
3. **Blueprint Pattern:** Modular API organization
4. **Unit of Work:** Transaction management
5. **Schema Validation:** Input validation and serialization
6. **Dependency Injection:** Services injected into routes

---

## Next Steps

- Review [Data Flow Map](./data-flow.md) for detailed data flow
- Review [API Inventory](./api-inventory.md) for endpoint details
- Check migrations folder for schema evolution
- See `SECURITY.md` for security audit (run `/document` with Security option)

---

**Documentation Status:** ✅ Complete
**Review Date:** Recommended quarterly review
